<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>SignalsLite Tests</title>
<script src="qunit/qunit.js"></script>
<script src="../src/SignalLite.js"></script>
<link href="qunit/qunit.css" rel="stylesheet" type="text/css">
</head>

<body>
<h1 id="qunit-header">SignalsLite Tests</h1>
<h2 id="qunit-banner"></h2>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<script>
(function() { "use strict";

var tested = new SignalLite();

module("SignalsLite");

test( "Basic Requirements", function() {
	expect(1);
	ok( Function.prototype.apply, "Function.apply()" );
});

test( "after setup, with 0 listeners", function()
{
	expect(2);
	var signaled = new SignalLite();
	
	equal(
		signaled.first, signaled.last,
		"after init, SignalLite.first and SignalLite.last should be equal."
	);
	
	strictEqual(
		signaled.first, signaled.last,
		"after init, SignalLite.first and SignalLite.last should be strictly equal."
	);
});

test("add and remove listener", function()
{
	var signaled = new SignalLite();
	var listener = function() {};
	
	ok( !signaled.has(listener),
		"signaled shouldn't has listener" );
	strictEqual( signaled.getLength(), 0,
		"signaled should has 0 listeners" );
	
	signaled.add( listener );
	strictEqual( signaled.getLength(), 1,
		"signaled should has 1 listener" );
	ok( signaled.has(listener),
		"signaled should has listener" );
	
	signaled.add( listener );
	ok( signaled.getLength(), 1,
		"signaled should still have only 1 listener, \
		after adding the same listener again");
	
	signaled.remove(listener);
	ok( !signaled.has(listener),
		"signaled shouldn't have listener" );
	strictEqual( signaled.getLength(), 0,
		"signaled should have 0 listeners");
	
	signaled.remove(listener);
});

test("normal dispatching", function()
{
	var signaled = new SignalLite();
	
	var dispatchedCount = 0;
	var listener = function() {
		dispatchedCount++;
	};
	
	signaled.add( listener );
	
	equal( dispatchedCount, 0, "dispatchedCount should be 0 before dispatch" );
	
	signaled.dispatch();
	equal( dispatchedCount, 1, "dispatchedCount should be 1 after one dispatch" );
	
	signaled.dispatch();
	equal( dispatchedCount, 2, "dispatchedCount should be 2 after two dispatches" );
	
	signaled.remove( listener );
});
test("once dispatching", function()
{
	var signaled = new SignalLite();
	
	var dispatchedCount = 0;
	signaled.once( function() {
		dispatchedCount++;
	} );
	
	strictEqual( dispatchedCount, 0, "dispatchedCount should be 0 before once dispatch" );
	strictEqual( signaled.getLength(), 1, "signaled should has 1 listener" );
	strictEqual( dispatchedCount, 0, "dispatchedCount should be 0 before dispatch" );
	
	signaled.dispatch();
	strictEqual( dispatchedCount, 1, "dispatchedCount should be 1 after one dispatch" );
	strictEqual( signaled.getLength(), 0, "signaled should has 0 listeners" );
	
	signaled.dispatch();
	strictEqual( dispatchedCount, 1, "dispatchedCount should be 1 after two dispatches" );
});

test("dispatching with arguments", function() {
	
	var signaled = new SignalLite();
	
	function listener( string, number, array ) {
		strictEqual( string, "", "argument should be a string");
		strictEqual( number, 0, "argument should be a number");
	}
	
	signaled.add( listener );
	signaled.dispatch( "", 0 );
	
} );
test("dispatching with thisArg", function() {
	expect(0); // :TODO:
} );
	
})();
</script>
</body>
</html>
