/* (c) 2012 Kevin Newman
license MIT
www.unfocus.com */
(function(){"use strict";function e(e,t){this.next=null,this.prev=null,this.listener=e,this.target=t}function t(t,n){this.first=new e,this.last=this.first,this.target=t,this.eachReturn=n,this.dispatching=!1}var n=t._cutNode=function(e){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),this.last===e&&(this.last=e.prev)};t.prototype={add:function(t,n){if(this.has(t))return;this.last.next=new e(t,n),this.last.next.prev=this.last,this.last=this.last.next},addToTop:function(t,n){this.has(t)&&(this.remove(t),this.addToTop(t));var r=new e(t,n);r.next=this.first.next,r.prev=this.first,this.first.next.prev=r,this.first.next=r},has:function(e){if(this.first===this.last)return!1;var t=this.first;do if(t.next&&t.next.listener===e)return!0;while(t=t.next);return!1},getLength:function(){var e=0,t=this.first;while(t=t.next)++e;return e},once:function(e,t){function r(){n.remove(r),e.apply(this,arguments)}var n=this;this.add(r,t)},remove:function(e){if(this.first===this.last)return;var t=this.first;while(t=t.next)if(t.listener===e){n.call(this,t);break}this.first===this.last&&(this.first.next=null)},removeAll:function(){this.first.next=null,this.first.prev=null,this.last=this.first},trigger:function(){if(this.first===this.last)return;this.dispatching=!0;var e=Array.prototype.slice.call(arguments),t=this.first;while((t=t.next)&&this.dispatching){var n=t.listener.apply(t.target||this.target,e);this.eachReturn&&this.eachReturn(n,e)}this.dispatching=!1},stopDispatch:function(){this.dispatching=!1}},window.SignalLite=t,window.SlotLite=e})(),function(){"use strict";function n(){SignalLite.apply(this,arguments);var n=this;this.ns=this.namespace=function(e){return this[e]||this.ns.add(e)},this.ns.add=function(r){if(n[r])return;return n[r]={add:function(e,t){n.add(e,t),n.last.ns=r},addToTop:function(e,t){n.addToTop(e,t),n.first.next.ns=r},remove:function(e){if(!e||n.first===n.last)return;var i=n.first;while(i=i.next)if(i.listener===e&&i.ns===r){t.call(n,i);break}n.first===n.last&&(n.first.next=null)},removeAll:function(){if(n.first===n.last)return;var e=n.first;while(e=e.next)e.ns===r&&t.call(n,e);n.first===n.last&&(n.first.next=null)},once:function(e,t){n.once(e,t),n.last.ns=r},priority:function(t){e=r;var i=n.priority(t);return e=null,i}},n[r]},this.ns.remove=function(e){delete n[e]};var r=n.priority(0);n.add=r.add,n.addToTop=r.addToTop,n.once=r.once}var e=null,t=SignalLite._cutNode;n.prototype=new SignalLite,n.prototype.priority=function(t){function n(e,n,o){r.has(e)&&r.remove(e);if(r.first===r.last){s.add.call(r,e,n),r.last.priority=t;return}var u=r.first;while(u=u.next)if(o(u.priority,t)){var a=new SlotLite(e,n);a.priority=t,a.next=u,a.prev=u.prev,u.prev.next=a,u.prev=a,a.ns=i;return}s.add.call(r,e,n),r.last.priority=t}var r=this,i=e,s=SignalLite.prototype,o={add:function(e,t){n(e,t,function(e,t){return e>t})},addToTop:function(e,t){n(e,t,function(e,t){return e>=t})},once:function(e,t){var n=r.add;r.add=o.add,s.once.call(r,e,t),r.add=n}};return o},window.Signal=n}(),function(){"use strict";function r(e,t,n){Signal.call(this,e,t),this.eachError=n}function i(e,t,r){try{var i=t.listener.apply(t.target||e.target,r);e.eachReturn&&e.eachReturn(i,r)}catch(s){throw n&&console&&console.error(s),e.eachError&&e.eachError(s),s}}var e=0,t=document||{},n=navigator.userAgent.indexOf("compatible")<0&&/Mozilla(.*)rv:(.*)Gecko/.test(navigator.userAgent);r.prototype=new Signal;if(t.addEventListener)r.prototype.dispatch=function(){function s(e,s){return function o(){r.removeEventListener(n,o,!1),e.dispatching&&i(e,s,t)}}if(this.first===this.last)return;var t=Array.prototype.slice.call(arguments),n="SignalLiteEvent"+ ++e,r=document,o=this.first;while(o=o.next)r.addEventListener(n,s(this,o),!1);this.dispatching=!0;var u=r.createEvent("UIEvents");u.initEvent(n,!1,!1),r.dispatchEvent(u)};else if(t.attachEvent){var s=t.documentElement;r.prototype.dispatch=function(){function r(e,r){return function(o){o.propertyName===n&&(s.detachEvent("onpropertychange",arguments.callee,!1),e.dispatching&&i(e,r,t))}}if(this.first===this.last)return;var t=Array.prototype.slice.call(arguments),n="SignalLiteEvent"+ ++e;s[n]=0,this.dispatching=!0;var o=this.first;while(o=o.next)s.attachEvent("onpropertychange",r(this,o),!1),s[n]++;try{delete s[n]}catch(u){s[n]=null}}}window.SignalDispatcher=r}()