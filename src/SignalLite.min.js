/* (c) 2012 Kevin Newman
license MIT
www.unfocus.com */
(function(e){"use strict";function i(e,t){this.next=null,this.prev=null,this.listener=e,this.target=t,this.ns=null}function s(e,t,r){this.first=new i,this.last=this.first,this.target=e,this.eachReturn=t,this.eachError=r,this.dispatching=!1;var s=this;this.namespace={add:function(e){if(s[e])return;s[e]={add:function(t,r){n=e,s.add(t,r),n=null},addToTop:function(t,r){n=e,s.addToTop(t,r),n=null},remove:function(t){if(!t)return;n=e,s.remove(t),n=null},removeAll:function(){if(s.first===s.last)return;var t=s.first;while(t=t.next)t.ns===e&&o.call(s,t);s.first===s.last&&(s.first.next=null)},once:function(t,r){n=e,s.once(t,r),n=null}}},remove:function(e){delete s[e]}}}function o(e){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),this.last===e&&(this.last=e.prev)}function u(e,t,n){try{var i=t.listener.apply(t.target||e.target,n);e.eachReturn&&e.eachReturn(i,n)}catch(s){throw r&&console&&console.error(s),e.eachError&&e.eachError(s),s}}var t=0,n=null,r=navigator.userAgent.indexOf("compatible")<0&&/Mozilla(.*)rv:(.*)Gecko/.test(navigator.userAgent);s.prototype={add:function(e,t){if(this.has(e))return;this.last.next=new i(e,t),this.last.next.prev=this.last,this.last=this.last.next,this.last.ns=n},addToTop:function(e,t){this.has(e)&&(this.remove(e),this.addToTop(e));var r=new i(e,t);r.next=this.first.next,r.prev=this.first,this.first.next.prev=r,this.first.next=r,r.ns=n},has:function(e){if(this.first===this.last)return!1;var t=this.first;do if(t.next&&t.next.listener===e)return!0;while(t=t.next);return!1},getLength:function(){var e=0,t=this.first;while(t=t.next)++e;return e},once:function(t,n){function i(){r.remove(i),t.apply(this,arguments),t=e,r=e}var r=this;this.add(i,n)},remove:function(e){if(this.first===this.last)return;var t=this.first;while(t=t.next)if(t.listener===e&&t.ns===n){o.call(this,t);break}this.first===this.last&&(this.first.next=null)},removeAll:function(){this.first.next=null,this.first.prev=null,this.last=this.first},trigger:function(){if(this.first===this.last)return;this.dispatching=!0;var e=Array.prototype.slice.call(arguments),t=this.first;while((t=t.next)&&this.dispatching){var n=t.listener.apply(t.target||this.target,e);this.eachReturn&&this.eachReturn(n,e)}this.dispatching=!1},dispatch:function(){function i(t,i){return function s(){r.removeEventListener(n,s,!1),t.dispatching&&u(t,i,e)}}if(this.first===this.last)return;var e=Array.prototype.slice.call(arguments),n="SignalLiteEvent"+ ++t,r=document,s=this.first;while(s=s.next)r.addEventListener(n,i(this,s),!1);this.dispatching=!0;var o=r.createEvent("UIEvents");o.initEvent(n,!1,!1),r.dispatchEvent(o)},stopDispatch:function(){this.dispatching=!1}};if(!document.addEventListener){var a=document.documentElement;s.prototype.dispatch=function(){function r(t,r){return function(i){i.propertyName===n&&(a.detachEvent("onpropertychange",arguments.callee,!1),t.dispatching&&u(t,r,e))}}if(this.first===this.last)return;var e=Array.prototype.slice.call(arguments),n="SignalLiteEvent"+ ++t;a[n]=0,this.dispatching=!0;var i=this.first;while(i=i.next)a.attachEvent("onpropertychange",r(this,i),!1),a[n]++;try{delete a[n]}catch(s){a[n]=null}}}window.SignalLite=s})()